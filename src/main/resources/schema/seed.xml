<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="seeding0001" author="daanschouten">
        <sql splitStatements="false">
            create table AIRCRAFT (
                hex_icao_id varchar(255) not null,
                iata_type varchar(255) not null,
                owner_iata_id varchar(255) not null,
                registration_date varchar(255) not null,
                primary key (hex_icao_id)
            );

            create table AIRPORT (
            iata_id varchar(255) not null,
            country varchar(255) not null,
            latitude double not null,
            longitude double not null,
            name varchar(255),
            primary key (iata_id)
            );

            create table CARRIER (
            iata_id varchar(255) not null,
            country varchar(255) not null,
            hub varchar(255) not null,
            name varchar(255) not null,
            primary key (iata_id)
            );

            create table FLIGHT (
            flight_id bigint generated by default as identity,
            actual_arrival timestamp,
            actual_departure timestamp,
            flight_number varchar(255),
            scheduled_arrival timestamp,
            scheduled_departure timestamp,
            aircraft_id varchar(255),
            airport varchar(255),
            carrier varchar(255),
            operator varchar(255),
            primary key (flight_id)
            );

            create table people (
            id bigint generated by default as identity,
            fullName varchar(255) not null,
            jobTitle varchar(255) not null,
            primary key (id)
            );

            alter table FLIGHT
            add constraint FKe5wmmgbp4yrp4r9n3jhjr6lhl
            foreign key (aircraft_id)
            references AIRCRAFT;

            alter table FLIGHT
            add constraint FKfobeiuadmds4ody6oy5n3y6py
            foreign key (airport)
            references AIRPORT;

            alter table FLIGHT
            add constraint FKt9latawsy1ipguh2e1p8rox2v
            foreign key (carrier)
            references CARRIER;

            alter table FLIGHT
            add constraint FKmu1shuighiugdjpmla7ju8b6w
            foreign key (operator)
            references CARRIER;
        </sql>
    </changeSet>
    <changeSet id="create-comunidad-autonoma-table" author="your-name">
        <createTable tableName="comunidad_autonoma">
            <column name="comunidad_autonoma_id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create Provincia table -->
    <changeSet id="create-provincia-table" author="dschouten">
        <createTable tableName="provincia">
            <column name="provincia_id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create Ayuntamiento table -->
    <changeSet id="create-ayuntamiento-table" author="dschouten">
        <createTable tableName="ayuntamiento">
            <column name="ayuntamiento_id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="phone" type="VARCHAR(50)">
                <constraints nullable="true"/>
            </column>
            <column name="provincia" type="BIGINT">
                <constraints nullable="true"/>
            </column>
            <column name="comunidad_autonoma" type="BIGINT">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add foreign key constraints -->
    <changeSet id="add-ayuntamiento-foreign-keys" author="dschouten">
        <addForeignKeyConstraint
                constraintName="fk_ayuntamiento_provincia"
                baseTableName="ayuntamiento"
                baseColumnNames="provincia"
                referencedTableName="provincia"
                referencedColumnNames="provincia_id"
                onDelete="SET NULL"
                onUpdate="CASCADE"/>

        <addForeignKeyConstraint
                constraintName="fk_ayuntamiento_comunidad_autonoma"
                baseTableName="ayuntamiento"
                baseColumnNames="comunidad_autonoma"
                referencedTableName="comunidad_autonoma"
                referencedColumnNames="comunidad_autonoma_id"
                onDelete="SET NULL"
                onUpdate="CASCADE"/>
    </changeSet>
</databaseChangeLog>
